<script>import { getFormField, setFormControl } from "../context.js";
import {
  getAriaDescribedBy,
  getAriaRequired,
  getDataFsError,
  generateId,
  getAriaInvalid
} from "../internal/utils/index.js";
import { writable } from "svelte/store";
export let id = generateId();
const { name, fieldErrorsId, descriptionId, errors, constraints } = getFormField();
const controlContext = {
  id: writable(id),
  attrs: writable(),
  labelAttrs: writable()
};
const { id: idStore } = controlContext;
$:
  controlContext.id.set(id);
setFormControl(controlContext);
$:
  errorAttr = getDataFsError($errors);
$:
  attrs = {
    name: $name,
    id: $idStore,
    "data-fs-error": errorAttr,
    "aria-describedby": getAriaDescribedBy({
      fieldErrorsId: $fieldErrorsId,
      descriptionId: $descriptionId,
      errors: $errors
    }),
    "aria-invalid": getAriaInvalid($errors),
    "aria-required": getAriaRequired($constraints),
    "data-fs-control": ""
  };
$:
  labelAttrs = {
    for: $idStore,
    "data-fs-label": "",
    "data-fs-error": errorAttr
  };
$:
  controlContext.attrs.set(attrs);
$:
  controlContext.labelAttrs.set(labelAttrs);
</script>

<!--
@component
## Control
Associates a [Label](https://formsnap.dev/docs/components/label) with and provides necessary attributes for a form control.

- [Control Documentation](https://formsnap.dev/docs/components/label)

@example
```svelte
<Control let:attrs>
	<Label>Name</Label>
	<input type="text" {...attrs} bind:value={$formData.name} />
</Control>
```

### Slot Props
- `attrs` - A spreadable object of attributes that must be applied to the form control element.
-->

<slot {attrs} />
